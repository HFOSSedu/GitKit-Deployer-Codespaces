
run:

  # GITKIT_DOCKER_TAG allows caller to supply the tag for the
  # GitKit Deployer Docker container. This is used when testing
  # to supply the tag for the branch being tested, or if one
  # wants to pin the version number of the deployer.
  # You can set environment variables for a dev container
  # in .devcontainer/devcontainer.json.
  - |
    if [ -n "$GITKIT_DOCKER_TAG" ]
    then
      echo "GITKIT_DOCKER_TAG detected: ${GITKIT_DOCKER_TAG}"
    fi

  - GITKIT_DOCKER_TAG:
      if-empty:
      value: latest

  - ORG_NAME:
      if-empty:
      description: |

        We will create a new repository that will become the upstream repository
        that you will share with your class. We will create it at the following URL:

            https://github.com/OWNER/NAME

      prompt: "Please enter the OWNER of the new repository: "
      validator:
        regex: "^[a-zA-Z0-9][a-zA-Z0-9_]{,38}$"
        tip: |

          Rules:
          - Only alphanumeric and underscore characters.
          - No more than 38 characters.

  - REPO_NAME:
      if-empty:
      prompt: "Please enter the NAME of the new repository: "
      validator:
        regex: "^[a-zA-Z0-9-_]{,100}$"
        tip: |

          Rules:
          - Only alphanumeric, hyphen, and underscore characters.
          - No more than 100 characters.

  - REPO_URL: "https://github.com/${ORG_NAME}/${REPO_NAME}"

  - GH_TOKEN:
      description: |+
        To create the repository, we need a personal access token
        with appropriate permissions.

        Navigate to https://github.com/settings/tokens/new

        Generate a token that expires in 7 days with the following scopes
            repo (all)
            workflow
            read:org (under admin:org)

      prompt: "Please paste the token you generated (input is not displayed): "
      secret: True

  - |
    echo "

      Creating ${REPO_URL} ...
    "

  -
    image: registry.gitlab.com/hfossedu/kits/gitkit:${GITKIT_DOCKER_TAG}
    environment:
      GH_TOKEN:
      REPO_NAME:
    command:
      - ${ORG_NAME}

  - |
    echo "
    Your new repository is ready. Give the URL below to your students.

        ${REPO_URL}

    As part of our NSF-funded project, we are gathering information on the use of GitKit.
    If you are currently integrating GitKit into a course you are instructing,
    we kindly request your participation in this brief survey:

        https://drexel.qualtrics.com/jfe/form/SV_81y8BL0zy3fBw22

    "
